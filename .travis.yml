language: php
php:
  - 5.6
  - 7.0
  - 7.1
  - 7.2
  - 7.3
  - 7.4
sudo: false
dist: trusty
before_install:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - wget http://selenium-release.storage.googleapis.com/2.53/selenium-server-standalone-2.53.1.jar
  - java -jar selenium-server-standalone-2.53.1.jar > /tmp/selenium.log 2> /tmp/selenium.error &
  - |
    if [ $TRAVIS_PHP_VERSION = "7.4" ]; then
      wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
      sudo apt update
      sudo apt install dpkg
      wget https://launchpad.net/ubuntu/+archive/primary/+files/libzip-dev_1.5.1-0ubuntu1_amd64.deb
      wget https://launchpad.net/ubuntu/+archive/primary/+files/libzip5_1.5.1-0ubuntu1_amd64.deb
      wget https://launchpad.net/ubuntu/+archive/primary/+files/libssl1.1_1.1.0g-2ubuntu4_amd64.deb
      sudo dpkg -i libzip-dev_1.5.1-0ubuntu1_amd64.deb libzip5_1.5.1-0ubuntu1_amd64.deb libssl1.1_1.1.0g-2ubuntu4_amd64.deb
      sudo apt install -y libzip-dev
      pecl install zip
    fi
install: composer install
before_script: php -S 0.0.0.0:8000 > /tmp/server.log 2>&1 &
script: vendor/bin/phpunit -c tests/phpunit.xml
